name: trading-bdd
on: [push, pull_request]
jobs:
  run:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-java@v4
        with: { distribution: temurin, java-version: '17' }
      - uses: actions/setup-python@v5
        with: { python-version: '3.11' }
      - run: python -m venv .venv
      - run: .\.venv\Scripts\python.exe -m pip install --upgrade pip
        shell: cmd
      - run: .\.venv\Scripts\pip.exe install robotframework allure-robotframework robotremoteserver
        shell: cmd
      - run: mvn -q -DskipTests install
      - run: |
          start /B java -DREMOTE_HOST=127.0.0.1 -DREMOTE_PORT=8270 -jar keywords-remote\target\keywords-remote-1.0.0.jar
          ping 127.0.0.1 -n 10 > nul
          netstat -ano | findstr "8270"
        shell: cmd
      - run: .\.venv\Scripts\robot.exe --listener allure_robotframework;outdir=tests-robot/logs/allure-results --variable REMOTE_HOST:127.0.0.1 --variable REMOTE_PORT:8270 -d tests-robot/logs tests-robot/run_feature_tests.robot
        shell: cmd
      - uses: actions/upload-artifact@v4
        with: { name: robot-and-allure, path: tests-robot/logs/** }

